# HTTP와 자바스크립트

클라이언트와 서버간의 소통 방법은 무엇이 있을까?

목적

1. HTTP가 무엇인가?
2. HTTP 메시지는 어떻게, 어디서 읽을 수 있는가?
3. 자바스크립트로 HTTP를 제어할 수 있는가? 방법은 무엇인가?
4. 보안 HTTPS 등

> 참고
> [MDN - HTTP](https://developer.mozilla.org/ko/docs/Web/HTTP/Basics_of_HTTP)

## 개요

HTTP는 HTML 문서와 같은 리소스들을 가져올 수 있도록 해주는 프로토콜이다. HTTP는 웹에서 이루어지는 모든 데이터 교환의 기초이며, 클라이언트-서버 프로토콜이기도 하다.

클라이언트-서버 프로토콜은 수신자 측에 의해 요청이 초기화되는 프로토콜을 의미한다. 하나의 완전한 문서는 텍스트, 레이아웃, 설명, 이미지, 비디오, 스크립트 등 불러온 하위 문서들로 제구성된다.

HTTP는 애플리케이션 계측의 프로토콜로, 신뢰 가능한 전송 프로토콜이라면 이론상으로는 무엇이든 사용할 수 있으나 TCP 혹은 TLS를 통해 전송된다.

## 메시지 교환

### request, responses

request는 클라이언트(브라우저)에 의해 전송되는 메시지다.
responses는 전송된 메시지에 대해서 서버에서 응답으로 전송되는 메시지다.

### TCP, TLS

https://developer.mozilla.org/ko/docs/Glossary/TCP
https://developer.mozilla.org/ko/docs/Glossary/TLS

## HTTP 기반 시스템의 구성요소

HTTP 요청은 하나의 개체, 사용자 에이전트에 의해 전송된다. 대부분의 사용자 에이전트는 브라우저지만, 무엇이든 될 수 있다.

서버는 request(요청)을 처리하고 response(응답)을 제공한다. 요청과 응답 사이에는 다양한 작업을 수행하는 게이트웨이 또는 캐시 역할을 하는 프록시 등이 있다.

HTTP는 애플리케이션 계층의 최상위에 있다.

### 클라이언트 : 사용자 에이전트

사용자 에이전트는 사용자를 대신하여 동작하는 모든 도구다. 주로 브라우저에 의해 수행된다.

브라우저는 **항상** 요청을 보내는 개체다. 결코 서버가 될 수 없다.

#### 웹 페이지를 표시하기 위해

1.  브라우저는 페이지의 HTML 문서를 가져오기 위한 요청을 전송
2.  파일을 구문 분석하여 실행해야 할 스크립트 그리고 페이지 내 포함된 하위 리소스, CSS에 대응하는 추가적인 요청들을 가져온다.
3.  브라우저는 불러온 리소스를 혼합한다.
4.  브라우저에 의해 실행된 스크립트는 이후 단계에서 조금 더 많은 리소스를 가져올 수 있다.
5.  브라우저는 그에 따라 웹 페이지를 갱신하게 된다.

웹 페이지는 하이퍼텍스트 문서이다. 사용자가 에이전트를 제어하고 웹을 돌아다닐 수 있도록 새로운 웹 페이지를 가져오기 위해 실행될 수 있는 링크를 뜻한다. 브라우저는 HTTP 요청 내에서 이런 지시 사항들을 변환하고 HTTP 응답을 해석하여 사용자에게 명확한 응답을 표시한다.

#### 웹 서버

웹 서버는 클라이언트의 요청에 대한 문서를 제공하는 서버가 존재한다.
서버는 논리적으로 단일 기계다.

서버가 반드시 단일 머신일 필요는 없지만, 여러 개의 서버를 동일한 머신 위에서 호스팅 할 수 있다. HTTP/1.1과 Host 헤더를 이용하여 동일한 IP 주소를 공유할 수도 있다.

#### 프록시

웹 브라우저와 서버 사이에는 수많은 컴퓨터와 머신이 HTTP 메시지를 이어 받고 전달한다. 여러 계층으로 이루어진 웹 스택 구조에서 전송, 네트워크 혹은 물리 계층에서 동작한다. 성능에 상당히 큰 영향을 주지만 HTTP 계층에서는 이들이 어떻게 동작하는지 눈에 보이지 않는다.

프록시는 컴퓨터/머신 중에서도 애플리케이션 계층에서 동작하는 것을 뜻한다.

프록시의 기능

- 캐싱
- 필터링
- 로드 밸런싱
- 인증
- 로깅

### HTTP의 기초

#### HTTP는 간단하다.

사람이 읽을 수 있다. HTTP/2가 복잡해졌지만 HTTP 메시지를 프레임별로 캡슐화하여 간결함을 유지했다.

#### 확장 가능하다.

HTTP/1.0에서 소개된, HTTP 헤더는 HTTP를 확장하고 실험하기 쉽게 만들어주었다. 클라이언트와 서버가 새로운 헤더의 시맨틱에 대해 간단한 합의만 한다면 언제든지 새로운 기능을 추가할 수 있다.

#### HTTP는 상태가 없지만 세션은 있다.

HTTP는 상태를 저장하지 않는다. 그러나 HTTP 쿠키는 상태가 있는 세션을 만들 수 있게한다. 헤더 확장성을 사용하여, 동일한 컨텍스트 또는 동일한 상태를 공유하기 위해 각가의 요청들에 세션을 만들도록 HTTP 쿠키가 추가된다.

#### HTTP와 연결

연결은 전송 계층에서 제어되기 때문에 근본적으로 HTTP 영역 밖이다. 신뢰할 수 있거나 메시지 손실이 없는 연결을 요구할 뿐이다.

클라이언트와 서버가 요청, 응답으로 HTTP를 교환하기 전에 여러 왕복이 필요한 프로세스인 TCP 연결을 설정해야한다.

## HTTP로 제어할 수 있는 것

### 캐시

문서가 캐시되는 방식을 제어할 수 있다. 서버는 캐시 대상과 기간을 프록시와 클라이언트에 지시할 수 있고 클라이언트는 저장된 문서를 무시하라고 중간 캐시 프록시에게 지시할 수 있다.

### Origin 제약 사항을 완화하기

동일한 origin으로부터 온 웹 페이지만 웹 페이지의 전체 정보에 접근할 수 있다. HTTP 헤더를 통해 그것을 환화시킬 수 있다.

### 인증

기본 인증은 HTTP를 통해 WWW-Authenticate 또는 유사한 헤더를 사용해 제공되거나, HTTP 쿠키를 사용해 특정 세션을 설정하여 이루어질 수 있다.

### 프록시와 터널링

HTTP 요청은 네트워크 장벽을 가로지르기 위해 프록시를 통해 나가게 된다. 하지만 모든 프록시가 HTTP 프록시는 아니다.

### 세션

쿠키 사용은 서버 상태를 요청과 연결하도록 해준다. 이것은 HTTP가 기본적으로 상태없는 프로토콜임에도 세션을 만들어주는 계기가 된다. 이는 사용자 구성을 허용하는 모든 사이트에 대해서 유용하다.

## HTTP 흐름

클라이언트가 서버와 통신하고자 할때

1. TCP 연결을 연다. TCP 연결은 요청을 보내거나 응답을 받는데 사용된다.
2. HTTP 메시지를 전송한다.

```
GET / HTTP/1.1
Host: example.com
Accept-Language: en
```

3. 서버에 의해 전송된 응답을 읽어들인다.

```
HTTP/1.1 200 OK
Date: Sat, 09 Oct 2010 14:28:02 GMT
Server: Apache
Last-Modified: Tue, 01 Dec 2009 20:18:22 GMT
ETag: "51142bc1-7449-479b075b2891b"
Accept-Ranges: bytes
Content-Length: 29769
Content-Type: text/html

<!DOCTYPE html... (here comes the 29769 bytes of the requested web page)
```

4. 연결을 닫거나 다른 요청들을 위해 재사용한다.

## HTTP 메시지

### 요청(requests)

```
GET(method) /(path) HTTP/1.1(version of the protocol)
Host: example.com
Accept-Language: en
(Headers)
```

### 응답(responses)

```
HTTP/1.1(Version of the protocol) 200(Status code) OK(Status message)
Date: Sat, 09 Oct 2010 14:28:02 GMT
Server: Apache
Last-Modified: Tue, 01 Dec 2009 20:18:22 GMT
ETag: "51142bc1-7449-479b075b2891b"
Accept-Ranges: bytes
Content-Length: 29769
Content-Type: text/html
(Headers)
```

## HTTP 기반 API

일반적으로 사용된 API는 XMLHttpRequest와 fetch가 있다.

서버-전송 이벤트는 서버가 전송 메커니즘으로 HTTP를 사용하여, 클라이언트로 이벤트를 보낼 수 있도록 하는 단방향 서비스다.

# RESTful API

# 웹 보안 기본

## CORS

## CSP

## XSS

## DB Injection

# 쿠키와 세션

1. 쿠키, 세션이란?
2. 쿠키와 세션을 다루는 방법(프론트, 백앤드)
3. 쿠키, 세션과 보안
